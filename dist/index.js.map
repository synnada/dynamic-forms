{"version":3,"file":"index.js","sources":["../src/hooks.ts","../src/appReducer.tsx","../src/store.ts","../src/index.tsx"],"sourcesContent":["/* eslint-disable no-unused-vars */\nimport { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\nimport type { RootState, AppDispatch } from './store'\n\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\n","/* eslint-disable no-case-declarations */\ntype Action = { type: 'get'; payload: any } | { type: 'set'; payload: any }\n// type Dispatch = (action: Action) => void\ntype State = { loadingArray: string[] }\n\nconst initialState: State = { loadingArray: [] }\n\nexport function appReducer(state: State = initialState, action: Action) {\n  switch (action.type) {\n    case 'set':\n      const { name, value }: any = action.payload\n      const draftTracing = [...state.loadingArray]\n      const fieldFoundIndex = draftTracing.indexOf(name)\n      const fieldFound = fieldFoundIndex > -1\n\n      if (value && !fieldFound) {\n        // yükleme başlasın\n        draftTracing.push(name)\n      } else if (!value && fieldFound) {\n        // yükleme duracak\n        draftTracing.splice(fieldFoundIndex, 1)\n      }\n      return {\n        ...state,\n        loadingArray: draftTracing\n      }\n  }\n\n  return state\n}\n","import { configureStore } from '@reduxjs/toolkit'\nimport { appReducer } from './appReducer'\n\nconst store = configureStore({\n  reducer: {\n    app: appReducer\n  }\n})\n\nexport type RootState = ReturnType<typeof store.getState>\nexport type AppDispatch = typeof store.dispatch\n\nexport default store\n","/* eslint-disable  */\n// @ts-ignore\nimport * as React from 'react'\n// @ts-ignore\nimport { useFormikContext, useField } from 'formik'\n// @ts-ignore\nimport deepEqual from 'deep-equal'\n// @ts-ignore\nimport * as deepcopy_ from 'deepcopy'\nimport { useAppSelector, useAppDispatch } from './hooks'\nimport store from './store'\nimport { Provider as ReduxProvider } from 'react-redux'\n// const deepCopy = deepcopy_\n// import styles from './styles.module.css'\n\n/* interface Props {\n  values: any\n} */\n\ninterface Rules {\n  initialValue?: any\n  fieldProps?: any\n  dependsOn?: any\n  manupilation?: any\n}\n\nexport interface FormContextData {\n  getLoading: (name?: string | undefined) => boolean\n  setLoading: (name: string, value: boolean) => void\n}\n\n/* type DynamicFormsProviderProps = { children: any } */\n\nexport const formContextDefaultValue: FormContextData = {\n  getLoading: () => false,\n  setLoading: () => null\n}\n\nexport const FormContext = React.createContext<FormContextData>(\n  formContextDefaultValue\n)\n\nexport const useDynamicForms = () => React.useContext(FormContext)\n\nexport const Provider = ({ children }: any) => {\n  const loadingArray = useAppSelector((state) => state.app.loadingArray)\n  const dispatch = useAppDispatch()\n  // NOTE: you *might* need to memoize this value\n  // Learn more in http://kcd.im/optimize-context\n\n  // const [loadingArray, setLoadingArray] = React.useState<string[]>([])\n\n  const setLoading = (name: string, value: boolean) => {\n    dispatch({ type: 'set', payload: { name, value } })\n  }\n\n  const getLoading = React.useCallback(\n    (name?: string) => {\n      if (!name) {\n        return Boolean(loadingArray.length)\n      }\n      return loadingArray[name]\n    },\n    [loadingArray]\n  )\n\n  const contextValue: FormContextData = { setLoading, getLoading }\n\n  return (\n    <FormContext.Provider value={contextValue}>{children}</FormContext.Provider>\n  )\n}\n\nexport const DynamicFormsProvider = (props: any) => (\n  <ReduxProvider store={store}>\n    <Provider {...props} />\n  </ReduxProvider>\n)\n\nexport const withDynamicForms = (rules: Rules) => (Component: any) => {\n  const defaultRules: Rules = {\n    dependsOn: {},\n    fieldProps: {},\n    manupilation: {}\n  }\n  rules = { ...defaultRules, ...rules }\n\n  const WrappedComponent = (props: any) => {\n    const { values, setFieldValue /* setFieldValue, setValues */ }: any =\n      useFormikContext()\n    const [, meta] = useField(props.name)\n    const [passed, setPassed] = React.useState<any>(undefined)\n    /* const [manupilationData, setManupilationData] =\n      React.useState<any>(undefined) */\n    // const { setValue } = helpers\n\n    const checkPassed = () =>\n      Object.keys(rules.dependsOn).findIndex((relationName) => {\n        const relationValue = values[relationName]\n        if (relationValue) {\n          if (!rules.dependsOn[relationName]({ values, relationValue })) {\n            return true\n          }\n        } else {\n          return true\n        }\n        return false\n      }) === -1\n\n    const cleanFieldValue = () => {\n      // delete field\n      /* setValues({\n        ...values\n      }) */\n      // setFieldValue(props.name, null)\n      //helpers.setValue(undefined)\n      // setValue(null)\n      console.log(props.name)\n\n      setFieldValue(props.name, undefined)\n      //delete meta.value\n    }\n\n    const checkManupilation = () => {\n      let manupilatedFieldProps = rules?.fieldProps || {}\n      const manupilationKeys = Object.keys(rules.manupilation)\n      for (let index = 0; index < manupilationKeys.length; index++) {\n        const relationName = manupilationKeys[index]\n        const relationPredicate = rules.manupilation[relationName]\n        if (relationPredicate) {\n          const relationValue = values[relationName]\n          const predicateResult = relationPredicate({ values, relationValue })\n\n          if (predicateResult) {\n            manupilatedFieldProps = {\n              ...manupilatedFieldProps,\n              ...predicateResult\n            }\n\n            manupilatedFieldProps.isManupilated = true\n            /* manupilatedFieldProps.manupilated = 'no'\n\n            if (!deepEqual(previousValues[props.name], values[props.name])) {\n              manupilatedFieldProps.manupilated = 'yes'\n            } */\n          } else {\n            /* manupilatedFieldProps.manupilated = undefined */\n          }\n\n          /* manupilatedFieldProps.isManupilated =\n            manupilatedFieldProps?.manupilated &&\n            manupilatedFieldProps?.manupilated === 'yes' */\n        }\n      }\n      return manupilatedFieldProps\n    }\n\n    React.useEffect(() => {\n      const isPassed = checkPassed()\n      if (isPassed) {\n        if (meta.value === undefined && rules?.initialValue !== undefined) {\n          setFieldValue(props.name, rules.initialValue)\n        }\n        /* setRenderedComponent(\n          <Component fieldProps={checkManupilation()} {...props} />\n        ) */\n        // setManupilationData(checkManupilation() || {})\n        setPassed(isPassed)\n      } else {\n        setPassed(undefined)\n        if (meta.value) {\n          cleanFieldValue()\n        }\n      }\n    }, [values])\n\n    /* if (isPassed) {\n      return <Component fieldProps={checkManupilation()} {...props} />\n    } else {\n      if (meta.value) {\n        cleanFieldValue()\n      }\n    } */\n\n    if (passed === undefined) return null\n\n    const d = checkManupilation()\n    return <Component fieldProps={d} {...props} />\n  }\n\n  return (props: any) =>\n    React.useMemo(() => <WrappedComponent {...props} />, [])\n}\n"],"names":["useAppDispatch","useDispatch","useAppSelector","useSelector","initialState","loadingArray","appReducer","state","action","type","payload","name","value","draftTracing","fieldFoundIndex","indexOf","fieldFound","push","splice","store","configureStore","reducer","app","formContextDefaultValue","getLoading","setLoading","FormContext","React","useDynamicForms","Provider","children","dispatch","Boolean","length","contextValue","DynamicFormsProvider","props","ReduxProvider","withDynamicForms","rules","Component","defaultRules","dependsOn","fieldProps","manupilation","WrappedComponent","useFormikContext","values","setFieldValue","useField","meta","undefined","passed","setPassed","checkPassed","Object","keys","findIndex","relationName","relationValue","cleanFieldValue","console","log","checkManupilation","manupilatedFieldProps","manupilationKeys","index","relationPredicate","predicateResult","isManupilated","isPassed","initialValue","d"],"mappings":"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"}
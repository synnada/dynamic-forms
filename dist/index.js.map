{"version":3,"file":"index.js","sources":["../src/hooks.ts","../src/appReducer.tsx","../src/store.ts","../src/utils.ts","../src/index.tsx"],"sourcesContent":["/* eslint-disable no-unused-vars */\r\nimport { TypedUseSelectorHook, useDispatch, useSelector } from 'react-redux'\r\nimport type { RootState, AppDispatch } from './store'\r\n\r\n// Use throughout your app instead of plain `useDispatch` and `useSelector`\r\nexport const useAppDispatch = () => useDispatch<AppDispatch>()\r\nexport const useAppSelector: TypedUseSelectorHook<RootState> = useSelector\r\n","/* eslint-disable no-case-declarations */\r\ntype Action = { type: string; payload: any }\r\n// type Dispatch = (action: Action) => void\r\ntype State = {\r\n  loadingArray: string[]\r\n  validationSchemaObject: object\r\n}\r\n\r\nconst initialState: State = {\r\n  loadingArray: [],\r\n  validationSchemaObject: {}\r\n}\r\n\r\nexport function appReducer(state: State = initialState, action: Action) {\r\n  switch (action.type) {\r\n    case 'setLoading':\r\n      const payload: any = action.payload\r\n      const draftTracing = [...state.loadingArray]\r\n      const fieldFoundIndex = draftTracing.indexOf(payload.name)\r\n      const fieldFound = fieldFoundIndex > -1\r\n\r\n      if (payload.value && !fieldFound) {\r\n        // yükleme başlasın\r\n        draftTracing.push(payload.name)\r\n      } else if (!payload.value && fieldFound) {\r\n        // yükleme duracak\r\n        draftTracing.splice(fieldFoundIndex, 1)\r\n      }\r\n      return {\r\n        ...state,\r\n        loadingArray: draftTracing\r\n      }\r\n    case 'addValidationSchema':\r\n      /* const draftObject = { ...state.validationSchemaObject }\r\n      draftObject[action.payload.name] = action.payload.rules.validationSchema */\r\n      return {\r\n        ...state\r\n        // validationSchemaObject: draftObject\r\n      }\r\n  }\r\n\r\n  return state\r\n}\r\n","import { configureStore } from '@reduxjs/toolkit'\r\nimport { appReducer } from './appReducer'\r\n\r\nconst store = configureStore({\r\n  reducer: {\r\n    app: appReducer\r\n  }\r\n})\r\n\r\nexport type RootState = ReturnType<typeof store.getState>\r\nexport type AppDispatch = typeof store.dispatch\r\n\r\nexport default store\r\n","/* eslint-disable */\r\n\r\nexport const deepStringify = (value: any) => {\r\n  const stringify = (data: any, prefix: any = null): string => {\r\n    function unicode_escape(c: any) {\r\n      var s = c.charCodeAt(0).toString(16)\r\n      while (s.length < 4) s = '0' + s\r\n      return '\\\\u' + s\r\n    }\r\n    if (!prefix) prefix = ''\r\n    switch (typeof data) {\r\n      case 'object': // object, array or null\r\n        if (data == null) return 'null'\r\n        var i,\r\n          pieces = [],\r\n          before,\r\n          after\r\n        var indent = prefix + '    '\r\n        if (data instanceof Array) {\r\n          for (i = 0; i < data.length; i++)\r\n            pieces.push(stringify(data[i], indent))\r\n          before = '[\\n'\r\n          after = ']'\r\n        } else {\r\n          for (i in data) pieces.push(i + ': ' + stringify(data[i], indent))\r\n          before = '{\\n'\r\n          after = '}'\r\n        }\r\n        return (\r\n          before + indent + pieces.join(',\\n' + indent) + '\\n' + prefix + after\r\n        )\r\n      case 'string':\r\n        data = data\r\n          .replace(/\\\\/g, '\\\\\\\\')\r\n          .replace(/\"/g, '\\\\\"')\r\n          .replace(/\\n/g, '\\\\n')\r\n          .replace(/\\r/g, '\\\\r')\r\n          .replace(/\\t/g, '\\\\t')\r\n          .replace(/[\\x00-\\x19]/g, unicode_escape)\r\n        return '\"' + data + '\"'\r\n      default:\r\n        return String(data).replace(/\\n/g, '\\n' + prefix)\r\n    }\r\n  }\r\n\r\n  return stringify(value)\r\n}\r\n","/* eslint-disable  */\r\n// @ts-ignore\r\nimport * as React from 'react'\r\n// @ts-ignore\r\nimport { useFormikContext, useField } from 'formik'\r\n// @ts-ignore\r\nimport deepEqual from 'deep-equal'\r\n// @ts-ignore\r\nimport * as deepcopy_ from 'deepcopy'\r\nimport { useAppSelector, useAppDispatch } from './hooks'\r\nimport store from './store'\r\nimport { Provider as ReduxProvider } from 'react-redux'\r\n// @ts-ignore\r\nimport * as Yup from 'yup'\r\n// @ts-ignore\r\nimport SparkMD5 from 'spark-md5'\r\nimport { deepStringify } from './utils'\r\n// const deepCopy = deepcopy_\r\n// import styles from './styles.module.css'\r\n\r\n/* interface Props {\r\n  values: any\r\n} */\r\n\r\ninterface Rules {\r\n  initialValue?: any\r\n  fieldProps?: any\r\n  dependsOn?: any\r\n  manupilation?: any\r\n  validationSchema?: any\r\n}\r\n\r\nexport interface FormContextData {\r\n  getLoading: (name?: string | undefined) => boolean\r\n  setLoading: (name: string, value: boolean) => void\r\n}\r\n\r\n/* type DynamicFormsProviderProps = { children: any } */\r\n\r\nexport const formContextDefaultValue: FormContextData = {\r\n  getLoading: () => false,\r\n  setLoading: () => null\r\n}\r\n\r\nexport const FormContext = React.createContext<FormContextData>(\r\n  formContextDefaultValue\r\n)\r\n\r\nexport const useDynamicForms = () => React.useContext(FormContext)\r\n\r\nexport const Provider = ({ children }: any) => {\r\n  const loadingArray = useAppSelector((state) => state.app.loadingArray)\r\n  /* const validationSchema = useAppSelector(\r\n    (state) => state.app.validationSchemaObject\r\n  ) */\r\n  const dispatch = useAppDispatch()\r\n  // NOTE: you *might* need to memoize this value\r\n  // Learn more in http://kcd.im/optimize-context\r\n\r\n  // const [loadingArray, setLoadingArray] = React.useState<string[]>([])\r\n\r\n  const setLoading = (name: string, value: boolean) => {\r\n    dispatch({ type: 'setLoading', payload: { name, value } })\r\n  }\r\n\r\n  const getLoading = React.useCallback(\r\n    (name?: string) => {\r\n      if (!name) {\r\n        return Boolean(loadingArray.length)\r\n      }\r\n      return loadingArray[name]\r\n    },\r\n    [loadingArray]\r\n  )\r\n\r\n  const contextValue: FormContextData = {\r\n    setLoading,\r\n    getLoading\r\n  }\r\n\r\n  return (\r\n    <FormContext.Provider value={contextValue}>{children}</FormContext.Provider>\r\n  )\r\n}\r\n\r\nexport const DynamicFormsProvider = (props: any) => (\r\n  <ReduxProvider store={store}>\r\n    <Provider {...props} />\r\n  </ReduxProvider>\r\n)\r\n\r\nexport const withDynamicForms = (rules: Rules) => (Component: any) => {\r\n  const defaultRules: Rules = {\r\n    dependsOn: {},\r\n    fieldProps: {},\r\n    manupilation: {}\r\n  }\r\n  rules = { ...defaultRules, ...rules }\r\n\r\n  const WrappedComponent = (props: any) => {\r\n    const {\r\n      values,\r\n      setFieldValue,\r\n      getFieldMeta /* setFieldValue, setValues */\r\n    }: any = useFormikContext()\r\n\r\n    const [, meta] = useField(props.name)\r\n    const [passed, setPassed] = React.useState<any>(undefined)\r\n    /* const [manupilationData, setManupilationData] =\r\n      React.useState<any>(undefined) */\r\n    // const { setValue } = helpers\r\n\r\n    const checkPassed = () =>\r\n      Object.keys(rules.dependsOn).findIndex((relationName) => {\r\n        const relationValue = values[relationName]\r\n        if (relationValue) {\r\n          if (!rules.dependsOn[relationName]({ values, relationValue })) {\r\n            return true\r\n          }\r\n        } else {\r\n          return true\r\n        }\r\n        return false\r\n      }) === -1\r\n\r\n    const cleanFieldValue = () => {\r\n      // delete field\r\n      /* setValues({\r\n        ...values\r\n      }) */\r\n      // setFieldValue(props.name, null)\r\n      //helpers.setValue(undefined)\r\n      // setValue(null)\r\n      console.log(props.name)\r\n\r\n      setFieldValue(props.name, undefined)\r\n      //delete meta.value\r\n    }\r\n\r\n    const checkManupilation = () => {\r\n      let manupilatedFieldProps = rules?.fieldProps || {}\r\n      const manupilationKeys = Object.keys(rules.manupilation)\r\n      for (let index = 0; index < manupilationKeys.length; index++) {\r\n        let relationName = manupilationKeys[index]\r\n        const relationPredicate = rules.manupilation[relationName]\r\n        if (relationPredicate) {\r\n          if (relationName.includes('%')) {\r\n            // that means the searched value is on the same index\r\n            let fieldName: string = props.name as string\r\n            let relationTail: string = relationName.substr(\r\n              relationName.indexOf('.'),\r\n              relationName.length\r\n            )\r\n            const fieldBase = fieldName.substr(0, fieldName.lastIndexOf('.'))\r\n            relationName = `${fieldBase}${relationTail}`\r\n          }\r\n\r\n          const _meta = getFieldMeta(relationName)\r\n          const relationValue = _meta.value\r\n          const predicateResult = relationPredicate({ values, relationValue })\r\n\r\n          if (predicateResult) {\r\n            manupilatedFieldProps = {\r\n              ...manupilatedFieldProps,\r\n              ...predicateResult\r\n            }\r\n\r\n            manupilatedFieldProps.isManupilated = SparkMD5.hash(\r\n              deepStringify(predicateResult)\r\n            )\r\n\r\n            /* manupilatedFieldProps.manupilated = 'no'\r\n\r\n            if (!deepEqual(previousValues[props.name], values[props.name])) {\r\n              manupilatedFieldProps.manupilated = 'yes'\r\n            } */\r\n          } else {\r\n            /* manupilatedFieldProps.manupilated = undefined */\r\n          }\r\n\r\n          /* manupilatedFieldProps.isManupilated =\r\n            manupilatedFieldProps?.manupilated &&\r\n            manupilatedFieldProps?.manupilated === 'yes' */\r\n        }\r\n      }\r\n      return manupilatedFieldProps\r\n    }\r\n\r\n    React.useEffect(() => {\r\n      const isPassed = checkPassed()\r\n      if (isPassed) {\r\n        // Reset value with initialValue\r\n        if (meta.value === undefined && rules?.initialValue !== undefined) {\r\n          setFieldValue(props.name, rules.initialValue)\r\n        }\r\n        /* if (rules.validationSchema) {\r\n          dispatch({\r\n            type: 'addValidationSchema',\r\n            payload: { rules, name: props.name }\r\n          })\r\n        } */\r\n        setPassed(isPassed)\r\n      } else {\r\n        setPassed(undefined)\r\n        if (meta.value) {\r\n          cleanFieldValue()\r\n        }\r\n      }\r\n    }, [values])\r\n\r\n    /* if (isPassed) {\r\n      return <Component fieldProps={checkManupilation()} {...props} />\r\n    } else {\r\n      if (meta.value) {\r\n        cleanFieldValue()\r\n      }\r\n    } */\r\n\r\n    if (passed === undefined) return null\r\n\r\n    const fieldProps = {\r\n      validationSchema: rules.validationSchema || {},\r\n      ...checkManupilation()\r\n    }\r\n\r\n    return <Component fieldProps={fieldProps} {...props} />\r\n  }\r\n\r\n  return (props: any) =>\r\n    React.useMemo(() => <WrappedComponent {...props} />, [])\r\n}\r\n"],"names":["useAppDispatch","useDispatch","useAppSelector","useSelector","initialState","loadingArray","validationSchemaObject","appReducer","state","action","type","payload","draftTracing","fieldFoundIndex","indexOf","name","fieldFound","value","push","splice","store","configureStore","reducer","app","deepStringify","stringify","data","prefix","unicode_escape","c","s","charCodeAt","toString","length","i","pieces","before","after","indent","Array","join","replace","String","formContextDefaultValue","getLoading","setLoading","FormContext","React","useDynamicForms","Provider","children","dispatch","Boolean","contextValue","DynamicFormsProvider","props","ReduxProvider","withDynamicForms","rules","Component","defaultRules","dependsOn","fieldProps","manupilation","WrappedComponent","useFormikContext","values","setFieldValue","getFieldMeta","useField","meta","undefined","passed","setPassed","checkPassed","Object","keys","findIndex","relationName","relationValue","cleanFieldValue","console","log","checkManupilation","manupilatedFieldProps","manupilationKeys","index","relationPredicate","includes","fieldName","relationTail","substr","fieldBase","lastIndexOf","_meta","predicateResult","isManupilated","SparkMD5","hash","isPassed","initialValue","validationSchema"],"mappings":"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"}